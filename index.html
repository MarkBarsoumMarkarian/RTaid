<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RT-qPCR Plate Tracker</title>
<script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.development.min.js"></script>
<script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.development.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
<div id="root"></div>

<script type="text/babel">

const { useState } = React;

// Icons
const ChevronRight = () => (
  <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <polyline points="9 18 15 12 9 6"></polyline>
  </svg>
);
const ChevronLeft = () => (
  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <polyline points="15 18 9 12 15 6"></polyline>
  </svg>
);
const RotateCcw = () => (
  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <polyline points="1 4 1 10 7 10"></polyline>
    <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
  </svg>
);
const Edit2 = () => (
  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
  </svg>
);

const RTqPCRTracker = () => {
  const [currentPatient, setCurrentPatient] = useState(36);
  const [currentSample, setCurrentSample] = useState('N');
  const [currentPrimer, setCurrentPrimer] = useState(1);
  const [currentReplicate, setCurrentReplicate] = useState(1);
  const [history, setHistory] = useState([]);
  const [showPatientInput, setShowPatientInput] = useState(false);
  const [newPatientNumber, setNewPatientNumber] = useState('');

  const getWellPosition = () => {
    const rows = currentSample === 'N' ? ['A','C','E','G'] : ['B','D','F','H'];
    const row = rows[currentPrimer-1];
    const completedPatients = new Set(history.map(h => h.patient.slice(0,-1))).size;
    const colOffset = completedPatients * 2;
    const col = colOffset + currentReplicate;
    return `${row}${col}`;
  };

  const getCurrentInfo = () => ({
    patient: `${currentPatient}${currentSample}`,
    primer: currentPrimer,
    replicate: currentReplicate,
    well: getWellPosition()
  });

  const advancePosition = () => {
    const current = getCurrentInfo();
    setHistory([...history, current]);

    if(currentReplicate===1) setCurrentReplicate(2);
    else if(currentPrimer<4){ setCurrentPrimer(currentPrimer+1); setCurrentReplicate(1);}
    else if(currentSample==='N'){ setCurrentSample('T'); setCurrentPrimer(1); setCurrentReplicate(1);}
    else{ setShowPatientInput(true); setNewPatientNumber(''); }
  };

  const handleNewPatient = () => {
    const patientNum = parseInt(newPatientNumber);
    if(isNaN(patientNum)||patientNum<=0){ alert('Please enter a valid patient number'); return;}
    setCurrentPatient(patientNum);
    setCurrentSample('N');
    setCurrentPrimer(1);
    setCurrentReplicate(1);
    setShowPatientInput(false);
    setNewPatientNumber('');
  };

  const goBack = () => {
    if(history.length===0) return;
    const previous = history[history.length-1];
    setHistory(history.slice(0,-1));
    setCurrentPatient(parseInt(previous.patient.slice(0,-1)));
    setCurrentSample(previous.patient.slice(-1));
    setCurrentPrimer(previous.primer);
    setCurrentReplicate(previous.replicate);
    setShowPatientInput(false);
  };

  const reset = () => {
    if(window.confirm("Reset to beginning? This will clear all progress.")){
      setCurrentPatient(36); setCurrentSample('N'); setCurrentPrimer(1); setCurrentReplicate(1);
      setHistory([]); setShowPatientInput(false);
    }
  };

  const editPatientNumber = () => {
    const newNum = prompt('Enter new patient number:', currentPatient);
    if(newNum && !isNaN(parseInt(newNum))) setCurrentPatient(parseInt(newNum));
  };

  const generatePlate = () => {
    const rows = ['A','B','C','D','E','F','G','H'];
    const cols = Array.from({length:12},(_,i)=>i+1);
    const currentWell = getWellPosition();

    return rows.map(row=>(
      <div key={row} className="flex items-center gap-1">
        <div className="w-6 text-xs font-semibold text-gray-600">{row}</div>
        {cols.map(col=>{
          const well = `${row}${col}`;
          const isCompleted = history.some(h=>h.well===well);
          const isCurrent = well===currentWell;
          return (
            <div key={well} className={`w-8 h-8 rounded border text-xs flex items-center justify-center font-medium transition-all
              ${isCurrent?'bg-blue-500 text-white border-blue-600 shadow-lg scale-110':''}
              ${isCompleted&&!isCurrent?'bg-green-100 border-green-300 text-green-700':''}
              ${!isCompleted&&!isCurrent?'bg-gray-50 border-gray-200 text-gray-400':''}`}>
              {col}
            </div>
          )
        })}
      </div>
    ));
  };

  const current = getCurrentInfo();

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
      <div className="max-w-4xl mx-auto">
        <div className="bg-white rounded-lg shadow-lg p-6 mb-4">
          <h1 className="text-2xl font-bold text-gray-800 mb-2">RT-qPCR Plate Tracker</h1>
          <p className="text-gray-600 text-sm">Track your sample loading in real-time</p>
        </div>

        {showPatientInput && (
          <div className="bg-white rounded-lg shadow-lg p-8 mb-4 border-4 border-blue-500">
            <h2 className="text-xl font-bold text-gray-800 mb-4">Enter Next Patient Number</h2>
            <input type="number" value={newPatientNumber} onChange={e=>setNewPatientNumber(e.target.value)}
              onKeyDown={e=>e.key==='Enter'&&handleNewPatient()} placeholder="e.g., 57"
              className="w-full text-2xl p-4 border-2 border-gray-300 rounded-lg mb-4 text-center" autoFocus/>
            <button onClick={handleNewPatient} className="w-full bg-blue-500 hover:bg-blue-600 text-white text-xl font-bold py-4 rounded-lg shadow-lg transition-all">
              Start Patient {newPatientNumber || '?'}
            </button>
          </div>
        )}

        {!showPatientInput && (
          <div className="bg-white rounded-lg shadow-lg p-8 mb-4">
            <div className="text-center mb-6">
              <div className="text-sm text-gray-500 mb-2">CURRENT WELL</div>
              <div className="text-6xl font-bold text-blue-600 mb-4">{current.well}</div>
              <div className="flex items-center justify-center gap-2 mb-2">
                <div className="text-2xl font-semibold text-gray-700">Patient {current.patient}</div>
                <button onClick={editPatientNumber} className="p-2 text-gray-400 hover:text-blue-500"><Edit2/></button>
              </div>
              <div className="text-lg text-gray-600">Primer {current.primer} â€¢ Replicate {current.replicate}</div>
            </div>

            <button onClick={advancePosition} className="w-full bg-blue-500 hover:bg-blue-600 text-white text-2xl font-bold py-8 rounded-lg shadow-lg transition-all flex items-center justify-center gap-3">
              Next Well <ChevronRight/>
            </button>

            <div className="flex gap-3 mt-4">
              <button onClick={goBack} disabled={history.length===0} className="flex-1 bg-gray-200 hover:bg-gray-300 disabled:bg-gray-100 disabled:text-gray-400 text-gray-700 font-semibold py-3 rounded-lg flex items-center justify-center gap-2"><ChevronLeft/> Back</button>
              <button onClick={reset} className="flex-1 bg-red-100 hover:bg-red-200 text-red-700 font-semibold py-3 rounded-lg flex items-center justify-center gap-2"><RotateCcw/> Reset</button>
            </div>

            <div className="mt-4 text-center text-sm text-gray-500">Wells completed: {history.length}</div>
          </div>
        )}

        <div className="bg-white rounded-lg shadow-lg p-6">
          <h2 className="text-lg font-semibold text-gray-700 mb-4">96-Well Plate</h2>
          <div className="overflow-x-auto">
            <div className="inline-block min-w-full">
              <div className="flex gap-1 mb-2 ml-7">
                {Array.from({length:12},(_,i)=><div key={i} className="w-8 text-xs text-center font-semibold text-gray-600">{i+1}</div>)}
              </div>
              <div className="space-y-1">{generatePlate()}</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

ReactDOM.render(<RTqPCRTracker />, document.getElementById('root'));
</script>
</body>
</html>
